package de.tyrannus.venomhack.modules.exploit;

import de.tyrannus.venomhack.events.PacketEvent;
import de.tyrannus.venomhack.modules.Module;
import de.tyrannus.venomhack.settings.Setting;
import meteordevelopment.orbit.EventHandler;
import net.minecraft.util.Hand;
import net.minecraft.item.ShieldItem;
import net.minecraft.util.math.BlockPos;
import net.minecraft.util.math.Direction;
import net.minecraft.network.Packet;
import net.minecraft.network.packet.c2s.play.PlayerInteractEntityC2SPacket;
import net.minecraft.network.packet.c2s.play.PlayerActionC2SPacket;
import net.minecraft.network.packet.c2s.play.PlayerInteractItemC2SPacket;
import net.minecraft.network.packet.c2s.play.PlayerInteractEntityC2SPacket.class_5907;
import net.minecraft.network.packet.c2s.play.PlayerActionC2SPacket.class_2847;

public class MultiTask extends Module {
   private final Setting<Boolean> ncpShield = this.setting(
      "ncp-shield", "Will unblock the shield for a split setting when attacking to bypass NCP.", Boolean.valueOf(false)
   );
   public final Setting<Boolean> old = this.setting("1.12-mode", "Will allow placing and eating at the same time.", Boolean.valueOf(false));

   public MultiTask() {
      super(Module.Categories.EXPLOIT, "multi-task", "Allows you to eat and mine at the same time.");
   }

   @EventHandler
   private void onPacketSend(PacketEvent.Send event) {
      if (this.ncpShield.get() && mc.player != null) {
         if (mc.player.getOffHandStack().getItem() instanceof ShieldItem && mc.player.isUsingItem()) {
            Packet var3 = event.getPacket();
            if (var3 instanceof PlayerInteractEntityC2SPacket packet) {
               if (packet.type.getType() == class_5907.ATTACK) {
                  sendPacket(new PlayerActionC2SPacket(class_2847.RELEASE_USE_ITEM, BlockPos.ORIGIN, Direction.DOWN));
               }
            }
         }
      }
   }

   @EventHandler
   private void onPacketSent(PacketEvent.Sent event) {
      if (this.ncpShield.get() && mc.player != null) {
         if (mc.player.getOffHandStack().getItem() instanceof ShieldItem && mc.player.isUsingItem()) {
            Packet var3 = event.getPacket();
            if (var3 instanceof PlayerInteractEntityC2SPacket packet) {
               if (packet.type.getType() == class_5907.ATTACK) {
                  sendPacket(new PlayerInteractItemC2SPacket(Hand.OFF_HAND, 0));
               }
            }
         }
      }
   }
}
